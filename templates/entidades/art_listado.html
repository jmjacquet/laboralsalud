{% extends "base.html" %}
{% load static from staticfiles %}
{% load i18n l10n %}
{% load humanize %}
{% block pantalla %}LISTADO ARTs <small>carga e impresión</small>{% endblock pantalla%}
{% block botones %}<a class="btn btn-outline-primary btn-sm fm-create" href="{% url 'art_nuevo'%}" data-fm-head="AGREGAR ART" data-fm-callback="reload">Nueva ART</a>{% endblock botones %}
{% block principal %}                            
                    <div id="cargando" class="cargando" >
                        <span class="cargando-txt">CARGANDO...</span>
                        <img class="cargando-img" src="{% static 'img/loading-bars.svg' %}">
                    </div>
                    <table width="100%" id="art" style="display:none;" class="table table-striped compact table-hover table-no-bordered tabla_nueva nowrap">         
                        <thead >
                            <tr>
                                <th>#</th>
                                <th class="imprimir">Código</th>
                                <th class="imprimir">Nombre</th>
                                <th class="imprimir">Prestador</th>
                                <th class="imprimir">Auditor</th>
                                <th class="imprimir">Contacto</th>
                                <th class="imprimir">Teléfono</th>
                                <th class="imprimir">Celular</th>           
                                <th class="imprimir">EMail</th>                                           
                            </tr>
                        </thead>
                        <tbody>
                            {% for a in art %}
                            <tr
                             {% if a.baja %}
                                class='danger'
                             {% endif %}
                            >
                                
                                <td><div class="btn-group">
                                      <button class="btn btn-xs btn-secondary dropdown-toggle" title="{{ a.pk|safe}}" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="fas fa-cog"></i></button>
                                                                             
                                      <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                        <a class="dropdown-item fm-update" href="{% url 'art_editar' id=a.pk %}" title="Editar" data-fm-callback="reload" data-fm-head="EDITAR ART"data-fm-target="#object-{{ a.pk }}">Editar</a></a>
                                        <a class="dropdown-item modal-detail" href="{% url 'art_detalles' id=a.pk %}" data-modal-head="DETALLE ART {{a.codigo}}">Detalle</a>
                                        
                                      </div>
                                                               
                                    </div>
                                </td>                
                                <td>{{ a.codigo|default_if_none:'' }}</td>
                                <td>{{ a.nombre|default_if_none:'' }}</td>
                                <td>{{ a.prestador|default_if_none:'' }}</td>
                                <td>{{ a.auditor|default_if_none:'' }}</td>
                                <td>{{ a.contacto_nombre|default_if_none:'' }}</td>
                                <td>{{ a.contacto_telfijo|default_if_none:'' }}</td>
                                <td>{{ a.contacto_telcel|default_if_none:'' }}</td>
                                <td>{{ a.contacto_email|default_if_none:'' }}</td>                                
                            </tr>
                            {% endfor %}
                        </tbody>
                        <tfoot>
                            <tr>
                                <th></th> 
                                <th></th> 
                                <th></th>                                
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>
                                <th></th>                                                                
                            </tr>
                        </tfoot>
                        
                    </table>                   

{% endblock principal %}

{% block scripts_js %}     
<script type="text/javascript">

$(document).ready(function() { 
   
moment.locale('es');
$.fn.dataTable.moment('DD/MM/YYYY'); 
var tabla = $('#art').DataTable({
            "language": {
                "decimal": ",",
                "thousands": ".",                 
                "sProcessing": "Procesando...",
                "sLengthMenu": "Mostrar _MENU_ registros",
                "sZeroRecords": "No se encontraron resultados",
                "sEmptyTable": "No hay registros en esta tabla",
                "sInfo": "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
                "sInfoEmpty": "Mostrando registros del 0 al 0 de un total de 0 registros",
                "sInfoFiltered": "(filtrado de un total de _MAX_ registros)",
                "sInfoPostFix": "",
                "sSearch": "Buscar:",
                "sUrl": "",
                "sInfoThousands": ",",
                "sLoadingRecords": "Cargando...",
                "oPaginate": {
                    "sFirst": "Primero",
                    "sLast": "Ãšltimo",
                    "sNext": "Siguiente",
                    "sPrevious": "Anterior"
                },
                "oAria": {
                    "sSortAscending": ": Activar para ordenar la columna de manera ascendente",
                    "sSortDescending": ": Activar para ordenar la columna de manera descendente"
                },
                "decimal": ",",
                "thousands": ".",                
            },                      
           
         "columnDefs": [ {
                  "targets"  : 'no-sort',
                  "orderable": false,
                }],          
           "paging":   true,
           "lengthMenu": [[20, 50, -1], [20, 50, "Todos"]],
           "autoWidth": false,
           "order": [],
           "colReorder": true,
           "searching": true,
            fixedHeader: {
              header: true,
              footer: false
              },
            responsive: true,
            dom: 'Bfrtlip',
            buttons: [
                {
                    extend:    'colvis',
                    text:      '<i class="fa fa-list"></i>',
                    titleAttr: 'Ver/Ocultar',
                    className: 'btnToolbar',                    
                },
                {
                    extend:    'copyHtml5',
                    text:      '<i class="fa fa-files-o"></i>',
                    titleAttr: 'Copiar',
                    exportOptions: { columns: ':visible' },
                    className: 'btnToolbar',                    
                },
                {
                    extend:    'excel',
                    text:      '<i class="fa fa-file-excel-o"></i>',
                    titleAttr: 'Excel',
                    filename: 'CLIENTES',                    
                    exportOptions: {  modifier: {
                                        page: 'current'
                                    }, 
                                      columns: '.imprimir',
                                      format: {
                                      body: function(data, row, column, node) {
                                        var floatVal = function (i) {
                                            if (typeof i === "number") {
                                                return i;
                                            } else if (typeof i === "string") {
                                                i = i.replace(/\$/g, "");
                    i = i.replace(/\,/g ,"");                    
                    i = i.replace(/\./g, "");
                                                var result = parseFloat(i)/100;
                                                // console.log(result);
                                                if (isNaN(result)) {
                                                    try {
                                                        var result = $jq(i).text();
                                                        result = parseFloat(result);
                                                        if (isNaN(result)) { result = 0 };
                                                        return result * 1;
                                                    } catch (error) {
                                                        return 0;
                                                    }
                                                } else {
                                                    return result * 1;
                                                }
                                            } else {
                                                alert("Unhandled type for totals [" + (typeof i) + "]");
                                                return 0
                                            }
                                        };
                                          data = $('<p>' + data + '</p>').text();
                                          return (node.className=='importe') ? floatVal(data)  : data;
                                      }
                                    }},
                    className: 'btnToolbar',     
                },
               
                {
                    extend:    'pdfHtml5',
                    text:      '<i class="fa fa-file-pdf-o"></i>',
                    titleAttr: 'PDF',footer: true,
                    exportOptions: { columns: '.imprimir'},
                    orientation: 'landscape',
                    className: 'btnToolbar',                    
                },
                {
                    extend: 'print',
                    text:      '<i class="fa fa-print"></i>',
                    titleAttr: 'Imprimir',
                    exportOptions: { columns: '.imprimir' },
                    className: 'btnToolbar',                    
                },
            ],
            PreDrawCallback:function(){
            $("#cargando").show();
            },
            initComplete: function () {
               // this.api().columns().every( function () {[0, 1, 9]

                $("#art").show();
                  this.fnAdjustColumnSizing();
                $("#cargando").hide();
            }
        });




});
</script> 
{% endblock scripts_js %}



