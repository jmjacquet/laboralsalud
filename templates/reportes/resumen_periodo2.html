{% extends "base.html" %}
{% load static from staticfiles %}
{% load i18n %}
{% load bootstrap3 %}
{% load humanize %}
{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.4/jspdf.min.js"></script>
{% endblock extra_js %}
{% block breadcrumbs %}              
        <div class="breadcrumbs">
            Reporte Indicadores
        </div>
{% endblock breadcrumbs %}

{% block principal %}                            
<br>
    

<div class="col-md-12">   
  
 <div class="barra_busqueda" id="barra_busqueda">
  <div class="panel panel-primary">
      <div class="panel-heading">
                      PARÁMETROS DE BÚSQUEDA
      </div> 
      <div class="panel-body">
              <div class="col-md-12">
               <form class="form" accept-charset="UTF-8" autocomplete="off" role="form" action="" method="post">
                  {% csrf_token %} 
                  <div class="barra_busqueda col-sm-12">                                    
                          <div class="col-sm-1">{% bootstrap_field form.fdesde  %}</div>                                
                          <div class="col-sm-1">{% bootstrap_field form.fhasta  %}</div>                                    
                          <div class="col-sm-3">{% bootstrap_field form.empresa  %}</div>                                    
                          <div class="col-sm-2">{% bootstrap_field form.tipo_ausentismo  %}</div>                            
                          <div class="col-sm-2">{% bootstrap_field form.trab_cargo  %}</div>                            
                          <div class="col-sm-3">{% bootstrap_field form.empleado  %}</div>
                         
                          <div class="col-sm-12">
                         
                            <button class="btn btn-xs btn-primary text-center pull-right" type="submit">Buscar</button></div>
                          
                  </div>     
                          
              </div>
      </div>  
  </div>
  </div>
    <button class="btn btn-xs btn-primary text-center pull-right" value="Imprimir" name="submit" target="_blank">Imprimir</button>
  </form> 
     <button class="btn btn-xs btn-primary text-center pull-right" id="exportar" target="_blank">Exportar</button>
  
  <div id="reporte" class="row">  
      {% if aus_total %}
      <div class="col-sm-6">
        
          <div id="chart-container" class="panel panel-primary">
           
            <div class="panel-heading text-center">AUSENTISMO TOTAL</div>
            <div class="panel-body">
              <div class="row">
                <div class="col-sm-12">
                  <table class="table table-striped table-hover table-condensed table-no-bordered">
                    <tbody>
                      <tr>
                        <td  class="titulo" width="50%">Días caídos</td><td class="dato" width="50%">{{aus_total.dias_caidos_tot|default_if_none:0}}</td>
                      </tr>
                      <tr>
                        <td class="titulo">Cantidad de Empleados</td><td class="dato">{{aus_total.empleados_tot|default_if_none:0}}</td>                
                      </tr>
                      <tr>
                        <td  class="titulo">Días laborables del período</td><td class="dato">{{aus_total.dias_laborables|default_if_none:0}}</td>
                      </tr>
                      <tr>
                        <td class="titulo">Tasa de Ausentismo</td><td class="dato">{{aus_total.tasa_ausentismo|default_if_none:0}}%</td>                
                      </tr>
                      <tr>
                        <td class="titulo">Días trabajados</td><td class="dato">{{aus_total.dias_trab_tot|default_if_none:0}}</td>                
                      </tr>                  
                    </tbody>
                  </table>
                </div>
               </div>
               <div class="row">
                <div class="col-sm-12">                   
                     <div id="container" style="width: 100%;">
                        <canvas id="ausentismo_tot"></canvas>
                      </div>
                      
                </div>  
              </div>
                
            </div>
               
          </div>
       
      </div>    

      {% endif %}
          
  </div>
           
</div>



<script type="text/javascript">
  
$(document).ready(function() {  
$.fn.datepicker.dates['es'] = {
    days: ["Domingo", "Lunes", "Martes", "Miércoles", "Jueves", "Viernes", "Sábado", "Domingo"],
    daysShort: ["Dom", "Lun", "Mar", "Mié", "Jue", "Vie", "Sáb", "Dom"],
    daysMin: ["Do", "Lu", "Ma", "Mi", "Ju", "Vi", "Sa", "Do"],
    months: ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"],
    monthsShort: ["Ene", "Feb", "Mar", "Abr", "May", "Jun", "Jul", "Ago", "Sep", "Oct", "Nov", "Dic"],
    today: "Hoy"
  };
  
 $('.datepicker').datepicker({
        format: "dd/mm/yyyy",
        language: "es",
        autoclose: true,
        todayHighlight: true
  });

  $('.datepicker').each(function(){
      $(this).datepicker();
  });


  $("#id_empresa").chosen({
      no_results_text: "Empresa inexistente...",
      placeholder_text_single:"Seleccione una Empresa",
      allow_single_deselect: true,
  });


  
    




$('#exportar').click(function(event) {
   html2canvas(document.getElementById("chart-container"), {
      onrendered: function(canvas) {
         var img = canvas.toDataURL(); //image data of canvas
         var doc = new jsPDF();
         var divHeight = $("reporte").height();
         var divWidth = $("reporte").width();
         var ratio = divHeight / divWidth;
         doc.setFontSize(15);
         doc.text("Reporte Ausentismos Totales", 25, 10);
         doc.text($("#id_empresa").val(), 90, 10);


         doc.addImage(img,  'JPEG', 5,25, divWidth, divHeight);
         doc.save('test.pdf');
      }
   });
});

var config = {
      type: 'doughnut',
      data: {
        datasets: [{
            data: [10, 20, 30],
            backgroundColor: ["red", "blue", "green"], 
        }],

        // These labels appear in the legend and in the tooltips when hovering different arcs
        labels: [
            'Red',
            'Yellow',
            'Blue'
        ]
    },
      options: {
        responsive: true
      }
    };

      var ctx = document.getElementById('ausentismo_tot').getContext('2d');
      window.myPie = new Chart(ctx, config);


});  
</script>

{% endblock principal %}





